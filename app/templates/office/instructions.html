{% extends "base.html" %}
{% block title %}Instructions{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h3 class="mb-0">Instructions</h3>
        <div class="text-muted">User manual (step-by-step)</div>
    </div>
</div>

<div class="row g-3">
    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <label class="form-label">Search instructions</label>
                <input type="text" class="form-control" id="instructionsSearch" placeholder="Type to search...">
                <div class="form-text">Search by keyword (invoice, quote, bill, purchase order, email, voice, tax, etc.).</div>
                <div class="alert alert-light border mt-3 mb-0" id="instructionsSearchMeta" role="status">Showing all sections.</div>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="accordion" id="instructionsAccordion" data-instructions-container>
            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-1">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-1" aria-expanded="true" aria-controls="ins-collapse-1">
                        Getting started
                    </button>
                </h2>
                <div id="ins-collapse-1" class="accordion-collapse collapse show" aria-labelledby="ins-heading-1" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol class="mb-0">
                            <li>Log in.</li>
                            <li>Go to <strong>Dashboard</strong> to see recent invoices/bills and alerts.</li>
                            <li>Use the top menu to open:
                                <ul class="mb-0">
                                    <li>Accounts Receivable: Invoices, Quotes, Customers, Payments</li>
                                    <li>Accounts Payable: Bills, Vendors, Payments</li>
                                    <li>Operations: Purchase Orders</li>
                                    <li>Office: Agenda, Notifications, Document Library</li>
                                </ul>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-2">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-2" aria-expanded="false" aria-controls="ins-collapse-2">
                        Create an Invoice (manual)
                    </button>
                </h2>
                <div id="ins-collapse-2" class="accordion-collapse collapse" aria-labelledby="ins-heading-2" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol>
                            <li>Go to <strong>Accounts Receivable → Invoices</strong>.</li>
                            <li>Click <strong>Create Invoice</strong>.</li>
                            <li>Select the customer and fill invoice details (date, due date, terms, notes).</li>
                            <li>Enter line items:
                                <ul>
                                    <li>Each line has <strong>#</strong>, <strong>Description</strong>, <strong>Qty</strong>, <strong>Price</strong>.</li>
                                    <li>Use <strong>Add line</strong> to add more rows in order.</li>
                                </ul>
                            </li>
                            <li>Tax:
                                <ul>
                                    <li>Enter <strong>Tax %</strong> to calculate tax automatically.</li>
                                    <li>The <strong>Tax $</strong> field will be filled/updated.</li>
                                </ul>
                            </li>
                            <li>Confirm <strong>Subtotal / Tax / Total</strong> and save.</li>
                        </ol>
                        <div class="text-muted small">Tip: On mobile, the table can scroll horizontally inside the page.</div>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-3">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-3" aria-expanded="false" aria-controls="ins-collapse-3">
                        Create a Quote (manual)
                    </button>
                </h2>
                <div id="ins-collapse-3" class="accordion-collapse collapse" aria-labelledby="ins-heading-3" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol class="mb-0">
                            <li>Go to <strong>Accounts Receivable → Quotes</strong>.</li>
                            <li>Click <strong>Create Quote</strong>.</li>
                            <li>Fill customer, dates, and line items (Description, Qty, Price).</li>
                            <li>Use <strong>Tax %</strong> if needed and verify totals.</li>
                            <li>Save the quote.</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-4">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-4" aria-expanded="false" aria-controls="ins-collapse-4">
                        Create a Bill (manual)
                    </button>
                </h2>
                <div id="ins-collapse-4" class="accordion-collapse collapse" aria-labelledby="ins-heading-4" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol class="mb-0">
                            <li>Go to <strong>Accounts Payable → Bills</strong>.</li>
                            <li>Click <strong>Create Bill</strong>.</li>
                            <li>Select vendor and enter bill details.</li>
                            <li>Enter line items and optionally <strong>Tax %</strong>.</li>
                            <li>Save the bill.</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-5">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-5" aria-expanded="false" aria-controls="ins-collapse-5">
                        Create a Purchase Order (manual)
                    </button>
                </h2>
                <div id="ins-collapse-5" class="accordion-collapse collapse" aria-labelledby="ins-heading-5" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol class="mb-0">
                            <li>Go to <strong>Operations → Purchase Orders</strong>.</li>
                            <li>Click <strong>Create Purchase Order</strong>.</li>
                            <li>Select PO type (vendor/customer) and select the contact.</li>
                            <li>Enter line items and optionally <strong>Tax %</strong>.</li>
                            <li>Save the purchase order.</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-6">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-6" aria-expanded="false" aria-controls="ins-collapse-6">
                        Voice assistant (AI) basics
                    </button>
                </h2>
                <div id="ins-collapse-6" class="accordion-collapse collapse" aria-labelledby="ins-heading-6" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol>
                            <li>Click the <strong>microphone</strong> icon in the top bar.</li>
                            <li>Press <strong>Start</strong> and speak your command.</li>
                            <li>If the AI needs information, it will ask <strong>one question at a time</strong> and wait for your answer.</li>
                        </ol>
                        <div class="fw-semibold">Examples</div>
                        <ul class="mb-0">
                            <li>Create invoice for Juan Perez for 250</li>
                            <li>Create quote for Maria for 1200</li>
                            <li>Create bill for vendor ACME for 180</li>
                            <li>Create purchase order vendor for ACME for 500</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-7">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-7" aria-expanded="false" aria-controls="ins-collapse-7">
                        Email documents (voice)
                    </button>
                </h2>
                <div id="ins-collapse-7" class="accordion-collapse collapse" aria-labelledby="ins-heading-7" data-bs-parent="#instructionsAccordion">
                    <div class="accordion-body">
                        <ol>
                            <li>Use a voice command like:
                                <ul>
                                    <li>Email invoice INV-000123 to Juan Perez</li>
                                    <li>Email quote Q-000045 to Maria</li>
                                    <li>Email purchase order PO-000010 to ACME</li>
                                </ul>
                            </li>
                            <li>If the contact email is saved, the AI will use it.</li>
                            <li>If it’s missing, the AI will ask for the email and can optionally save it.</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="accordion-item" data-instructions-item>
                <h2 class="accordion-header" id="ins-heading-8">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ins-collapse-8" aria-expanded="false" aria-controls="ins-collapse-8">
                        Troubleshooting
                    </button>
                </h2>
                <div id="ins-collapse-8" class="accordion-collapse collapse" aria-labelledby="ins-heading-8" data-bs-parent="#instructionsAccordion">
                    <ul class="mb-0">
                        <li>If totals look wrong, check Qty/Price are numbers and Tax % is correct.</li>
                        <li>If the AI doesn’t understand, try shorter commands and clear numbers (example: “for 250 dollars”).</li>
                        <li>If a contact isn’t found by voice, confirm the exact customer/vendor name in the system.</li>
                    </ul>
                </div>
            </div>

            <div class="text-muted small mt-3" id="instructionsNoResults" style="display:none;">No results found.</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function () {
  const input = document.getElementById('instructionsSearch');
  const meta = document.getElementById('instructionsSearchMeta');
  const noResults = document.getElementById('instructionsNoResults');
  const container = document.querySelector('[data-instructions-container]');
  if (!input || !container) return;

  function applyFilter() {
    const q = (input.value || '').trim().toLowerCase();
    const items = Array.prototype.slice.call(container.querySelectorAll('[data-instructions-item]'));
    let shown = 0;

    items.forEach((item) => {
      const text = (item.textContent || '').toLowerCase();
      const match = !q || text.indexOf(q) !== -1;
      item.style.display = match ? '' : 'none';
      if (match) shown += 1;
    });

    if (!q) {
      meta.textContent = 'Showing all sections.';
    } else {
      meta.textContent = `Showing ${shown} section(s) for: "${q}"`;
    }

    noResults.style.display = (q && shown === 0) ? '' : 'none';
  }

  input.addEventListener('input', applyFilter);
})();
</script>
{% endblock %}
